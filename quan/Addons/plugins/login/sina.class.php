<?php //include_once( 'sina/config.php' );include_once( 'sina/saetv2.ex.class.php' );class sina{		var $loginUrl;	private $_saeAuth = null;		public function __construct() {		$this->_saeAuth = new SaeTOAuthV2( WB_AKEY , WB_SKEY );	}		function getUrl() {    	return $this->_saeAuth->getAuthorizeURL( WB_CALLBACK_URL );	}		function initToken($code)	{		$keys = array();		$keys['code'] = $_REQUEST['code'];		$keys['redirect_uri'] = WB_CALLBACK_URL;		$token = null;		try {			$token = $this->_saeAuth->getAccessToken( 'code', $keys ) ;		} catch (OAuthException $e) {			return null;		}		if ($token) {    		$_SESSION['sina']['token'] = $token;		}		return $token;	}		function get_openid()	{		if(! isset($_SESSION['sina']["openid"]) || ! $_SESSION['sina']["openid"]){			$c = new SaeTClientV2( WB_AKEY , WB_SKEY , $_SESSION['sina']['token']['access_token'] );			$uid_get = $c->get_uid();			$_SESSION['sina']["openid"] = $uid_get['uid'];		}		return $_SESSION['sina']["openid"];	}		//用户资料	function userInfo(){		$c = new SaeTClientV2( WB_AKEY , WB_SKEY , $_SESSION['sina']['token']['access_token'] );    	$uid = $this->get_openid();    	return $user = $c->show_user_by_id( $uid);//根据ID获取用户等基本信息	}		//关注官方微博	public function follow_office()	{		if(!defined('WB_OFFICE_UID') || !is_int(WB_OFFICE_UID)) return ;		$c = new SaeTClientV2( WB_AKEY , WB_SKEY , $_SESSION['sina']['token']['access_token'] );		return $c->follow_by_id( WB_OFFICE_UID );	}		/**	 * 发布微博	 *	 * @param string $status			微博内容	 */	public function update($status)	{		$c = new SaeTClientV2( WB_AKEY , WB_SKEY , $_SESSION['sina']['token']['access_token'] );		return $c->update( $status);	}		/**	 * 发表图片微博	 *	 * @param string $status			微博内容	 * @param string $pic_path			图片路径	 * @return unknown	 */	public function upload($status, $pic_path)	{		$c = new SaeTClientV2( WB_AKEY , WB_SKEY , $_SESSION['sina']['token']['access_token'] );		return $c->upload( $status, $pic_path);	}}